var ERROR_TEXT_BLANK = 'ne moje da e prazno';var ERROR_EMAIL_INVALID = 'nevaliden email';var ERROR_NOT_CHECKED = 'trqbva da e 4eknato';var ERROR_SELECT_BLANK = 'trqbva da e izbrano neshto';var ERROR_EMAIL_DUPLICATE = 'този адрес вече е изполван';var button;var form;var debug;var ERRORS;var DUPLICATES = [];if ($('menu'))     $('menu').hide();Event.observe(window, 'load', initLuftHansa);function initLuftHansa(){    ERRORS = new Hash();    button = $('submitButton');    form = $('lufthansaForm');    validateform();    bindinputs();    button.observe('click', submit);    button.enable();}function set_input_error(input){    var error_span = input.up('p').down('span.val');    if (ERRORS.get(input.id)) {        error_span.show();    }    else {        error_span.hide();    }}function set_error_msg(input, msg){    if (!input) {        return;    }    var error_msg = input.up('p').down('.error_msg');    if (!error_msg) {        return;    }    if (msg == null) {        error_msg.hide();    }    else         if (error_msg) {            error_msg.update(msg).show();        }}function updatebutton(){    if (ERRORS.keys().size() > 0) {        button.disable();    }    else {        button.enable();    }}function bindinputs(){    var input_error;    form.getInputs('text').each(function(input){        if (!input.hasClassName('optional')) {            input.observe('keyup', function(){                set_input_error(input, validate(input));            });            input.observe('change', function(){                set_input_error(input, validate(input));            });        }    });    form.getInputs('checkbox').each(function(input){        if (!input.hasClassName('optional')) {            input.observe('click', function(){                set_input_error(input, validate(input));            });        }    });    form.select('select').each(function(input){        if (!input.hasClassName('optional')) {            input.observe('change', function(){                set_input_error(input, validate(input));            });        }    });}function addEmail(email){    if (!DUPLICATES.include(email)) {        DUPLICATES.push(email);    }}function submit(){    button.disable();    if (validateform()) {        button.enable();        return;    }    addEmail($F('input_email'));    form.request({        onSuccess: function(t){            $('lufthansaResult').update(t.responseText);            $('lufthansaForm').hide();            $('lufthansaResult').show();        },        onFailure: function(t){            var result = new Hash(t.responseJSON);            var error = result.get('error');            if (error) {                var email = result.get('email');                if (email) {                    addEmail(email);                }                var input = result.get('element');                if (input) {                    ERRORS.set(input, error);                    set_error_msg($(input), error);                }                else {                    alert(error);                }            }        },        onComplete: function(){            button.enable();        }    });}function validateform(){    var elements = form.getInputs();    form.select('select').each(function(s){        elements.push(s);    });    elements.each(function(input){        input_error = validate(input);        if (input_error) {            set_input_error(input, input_error);        }    });    return ERRORS.keys().size() > 0;}function validate(input){    if (input.hasClassName('optional') || input.type == 'button' || input.type == 'hidden') {        return;    }    ERRORS.unset(input.id);    set_error_msg(input, null);    switch (input.type) {        case 'checkbox':            if (!input.checked) {                ERRORS.set(input.id, ERROR_NOT_CHECKED);            }            break;        case 'text':            if (input.value.blank()) {                ERRORS.set(input.id, ERROR_TEXT_BLANK);            }            else                 if (input.hasClassName('email')) {                    if (validateEmail(input.value)) {                        ERRORS.set(input.id, ERROR_EMAIL_INVALID);                    }                    else                         if (DUPLICATES.include(input.value)) {                            set_error_msg(input, ERROR_EMAIL_DUPLICATE);                        }                }            break;    }    if (input.tagName == 'SELECT') {        if (input.value.blank()) {            ERRORS.set(input.id, ERROR_SELECT_BLANK);        }    }    return ERRORS.get(input.id);}function validateEmail(value){    return !/^[^@]+@[-a-z0-9]+\.[a-z]{2,4}$/.test(value.toLowerCase());}